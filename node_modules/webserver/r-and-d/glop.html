<html>
<head>
	<script src=node_modules/sleepless/sleepless.js></script>

	<style>
		div {
			margin: 1em 2vw;
			background-color: rgba( 0, 0, 0, 0.1 );
			padding: 1em 2vw;
		};
	</style>
		
	<script>
		globalThis.G = globalThis;

		G.MX = 0;
		G.MY = 0;
		G.mouseMoved = false;

		G.summon = ( s, evt ) => {
			const f = G[ s ];
			if( typeof f == "function" ) 
				f( evt );
		}

		G.cur = e => {
			if( e !== undefined && e !== G.current_element ) {
				G.current_element = e;
			}
			return G.current_element;
		}

		window.onkeyup = evt => {
			summon( "evt_key_"+evt.key, evt );
		};

		window.onmousemove = evt => {
			
			G.MX = evt.x;
			G.MY = evt.y;
			G.mouseMoved = true;

			const e = document.elementFromPoint( G.MX, G.MY );
			if( e && e.glop ) {
				cur( e );
			} else {
				cur( null );
			}
		}

		const onmouseenter = evt => {
		}
		const onmouseleave = evt => {
		}

		G.div = h => {
			const e = document.createElement( "div" );
			e.glop = true;
			e.innerHTML =  h;
			e.onmouseenter = onmouseenter
			e.onmouseleave = onmouseleave
			return e;
		}

		G.evt_key_a = evt => { alert( "aye!" ) }
		G.evt_key_d = evt => {
			evt.stopPropagation();
			evt.preventDefault();
			const mom = cur() || document.body
			mom.appendChild( div( "Hi mom." ) );
		}

		let tick = 0;
		setInterval( function() {
			tick += 1

			if( G.mouseMoved || ( tick % 10 == 0 ) ) {
				G.mouseMoved = false;
				const e = cur();
				if( e && e.glop ) {
					const old = e.style.backgroundColor
					e.style.backgroundColor = "rgba(127,127,127,0.5)"
					setTimeout( function() {
						e.style.backgroundColor = old
					}, 500 );
				}
			}
		}, 100 );


	</script>
</head>
<body>
</body>
</html>
